<!doctype html><html lang="ja"><meta charset="utf-8"/>
<title>提出ページ（役員）</title>
<body>
<h1>購入希望届 提出</h1>
<form id="f" enctype="multipart/form-data">
<div>
<label>氏名: <select name="member_id" id="member"></select></label>
<label>部署: <select name="department_id" id="dept"></select></label>
</div>
<div>
<label>概要: <input name="summary" required maxlength="255"/></label>
</div>
<div>
<label>ネット購入:
<select name="expects_network">
<option value="NONE">なし（現金手渡し）</option>
<option value="CONVENIENCE">コンビニ払い</option>
<option value="BANK_TRANSFER">振込</option>
</select>
</label>
</div>
<div>
<label>購入希望届（Excel）<input type="file" name="excel" accept=".xlsx,.xls" required/></label>
</div>
<button>提出</button>
</form>
<script>
async function fetchMasters(){
const m = await (await fetch('/api/masters/members')).json();
const d = await (await fetch('/api/masters/departments')).json();
if(m.ok){ const sel=document.getElementById('member'); sel.innerHTML=m.data.map(x=>`<option value="${x.id}">${x.name}</option>`).join(''); }
if(d.ok){ const sel=document.getElementById('dept'); sel.innerHTML=d.data.map(x=>`<option value="${x.id}">${x.name}</option>`).join(''); }
}
fetchMasters();
document.getElementById('f').onsubmit = async (e)=>{
e.preventDefault();
const fd = new FormData(e.target);
const r = await fetch('/api/requests',{method:'POST',body:fd});
const j = await r.json();
if(j.ok) alert('受付番号: '+j.data.request_no); else alert(j.message);
};
</script>
</body></html>
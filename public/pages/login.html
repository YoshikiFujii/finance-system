<!doctype html><html lang="ja"><meta charset="utf-8"/>
<title>Lotus - ログイン</title>
<link rel="stylesheet" href="../assets/app.css?v=1"/>
<body class="login-page">
    <main class="container">
        <div class="logo-container">
            <img id="logo" src="../assets/logo-wh.png" alt="Lotus" class="logo">
        </div>
        <form id="loginForm">
            <label>
                ページ:
                <select id="role">
                    <option value="OFFICER">提出ページ（役員）</option>
                    <option value="FINANCE">財務ページ</option>
                    <option value="ADMIN">管理者ページ</option>
                </select>
            </label>
            <label>
                パスワード:
                <input id="pw" type="password" placeholder="パスワード"/>
            </label>
        </form>
        <button id="go">ログイン</button>
    </main>
<script>
// テーマに応じてロゴを切り替える関数
function updateLogo() {
    const logo = document.getElementById('logo');
    const isDarkTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    if (isDarkTheme) {
        logo.src = '../assets/logo-wh.png'; // ダークテーマ時は白いロゴ
    } else {
        logo.src = '../assets/logo-bl.png'; // ライトテーマ時は黒いロゴ
    }
}

// ページ読み込み時にロゴを設定
document.addEventListener('DOMContentLoaded', updateLogo);

// テーマ変更を監視
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateLogo);

async function login() {
    const role = document.getElementById('role').value;
    const password = document.getElementById('pw').value;
    
    // 直接index.phpにアクセス
    const formData = new FormData();
    formData.append('role', role);
    formData.append('password', password);
    
    const r = await fetch('/index.php', {
        method: 'POST',
        body: formData
    });
    
    const j = await r.json(); 
    if(!j.ok){ 
        alert(j.message); 
        return; 
    }
    location.href = role==='OFFICER'? '/pages/officer.html' : role==='FINANCE'? '/pages/finance.html' : '/pages/admin.html';
}

// ボタンクリックでログイン
document.getElementById('go').onclick = login;

// エンターキーでログイン
document.getElementById('loginForm').addEventListener('submit', (e) => {
    e.preventDefault();
    login();
});

// パスワードフィールドでエンターキーを押した時もログイン
document.getElementById('pw').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault();
        login();
    }
});
</script>

<footer class="page-footer">
    <div class="footer-content">
        <img src="../assets/RyoyuLogo.png" alt="寮友会ロゴ" class="footer-logo">
        <div class="footer-text">© 千葉工業大学寮友会執行役員会 / 財務管理システム - Lotus</div>
    </div>
</footer>
</body></html>